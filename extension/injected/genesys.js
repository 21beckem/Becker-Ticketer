HTMLCollection.prototype.forEach = Array.from(this).forEach;

// confirm before page refresh because you'll lose ticket progress.
window.onbeforeunload = function(event) {
    return "Are you sure you want to refresh the page?";
};
function openBeckerTicketManagerWindow(open = true) {
    let hiddenTicketerBtn = document.querySelector('*[title="Becker Ticketer Installer"]').querySelector('a');
    if (open) {
        hiddenTicketerBtn.click();
        setTimeout(()=>{ hiddenTicketerBtn.click() }, 500);
    }
}
// wait until page loads, then insert ticket button on the left sidebar
(async function() {

while ( !document.querySelector('UL.navigation-action-bar') ) { // wait until sidebar loads
    await new Promise(r => requestAnimationFrame(r));
}
await new Promise(r => setTimeout(r, 1000)); // wait a little longer just to be sure.

// add sidebar and ticket button
const sidebar = document.querySelector('UL.navigation-action-bar');
let newLiBtn = document.createElement('LI');
newLiBtn.classList.add('action-item');
newLiBtn.style.overflow = 'hidden';
newLiBtn.innerHTML = `
<a href="javascript:openBeckerTicketManagerWindow()">

    <div style="transform: scale(0.085);">
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="500" height="500">
            <path fill="#98A7B8" d="M0 0 C7.95886144 4.10826121 13.26790042 11.60159328 18.765625 18.4453125 C21.53479718 21.85017515 24.38238854 25.17813138 27.25 28.5 C31.75856384 33.72821378 36.16964461 39.01956 40.5078125 44.390625 C42.22777519 46.54104478 42.22777519 46.54104478 44.25 48.5 C43.9603409 52.17409695 42.16270237 53.85689378 39.625 56.375 C28.93529799 68.02600615 25.52120844 81.76240807 25.94140625 97.21484375 C26.71833236 111.73143411 34.24421432 124.51661348 44.65234375 134.3125 C48.60907332 137.64448279 52.59181499 140.25509156 57.25 142.5 C58.1059375 142.9125 58.961875 143.325 59.84375 143.75 C73.07043309 149.100119 88.62391668 147.90105729 101.8046875 143.01171875 C105.74918958 141.28096784 109.15794162 139.28300034 112.55078125 136.63671875 C114.25 135.5 114.25 135.5 117.25 135.5 C119.08984375 137.4140625 119.08984375 137.4140625 121.1875 140.125 C122.38052734 141.63320313 122.38052734 141.63320313 123.59765625 143.171875 C124.02578613 143.71392578 124.45391602 144.25597656 124.89501953 144.81445312 C127.23618448 147.72677795 129.68287093 150.54731305 132.125 153.375 C133.1460391 154.56232308 134.1668714 155.74982403 135.1875 156.9375 C135.69410156 157.52660156 136.20070313 158.11570313 136.72265625 158.72265625 C159.00344195 184.65042478 159.00344195 184.65042478 158.59375 195.8828125 C156.94382739 208.44472325 148.63092077 214.49917628 139.33984375 221.98046875 C135.92590783 224.76427237 132.58456179 227.62215287 129.25 230.5 C124.26094074 234.80012283 119.20777495 239.00486504 114.09375 243.15625 C110.77313514 245.89302049 107.50953218 248.6910295 104.25 251.5 C100.12531796 255.05453161 95.97792288 258.56792143 91.75 262 C86.34923828 266.38712902 81.075323 270.91223412 75.80078125 275.44921875 C68.53968997 281.69427321 61.24446571 287.8963115 53.8125 293.9375 C48.33030852 298.40030887 42.96547517 302.99298931 37.609375 307.60546875 C37.06345703 308.07388184 36.51753906 308.54229492 35.95507812 309.02490234 C34.74287796 310.07360129 33.53930795 311.13231224 32.34179688 312.19775391 C31.71853516 312.74737793 31.09527344 313.29700195 30.453125 313.86328125 C29.88754883 314.36770752 29.32197266 314.87213379 28.73925781 315.3918457 C27.25 316.5 27.25 316.5 25.25 316.5 C25.2406543 315.83282959 25.23130859 315.16565918 25.22167969 314.47827148 C24.79300972 289.88648426 24.23270271 260.92558559 6.5625 241.66015625 C1.06693471 236.66071838 -5.76981072 232.97684136 -12.75 230.5 C-10.66132961 228.41132961 -9.32702681 227.82327894 -6.625 226.75 C4.46032467 221.88240551 11.89373953 213.47370001 16.34082031 202.17651367 C20.7943829 189.06577074 20.81295067 175.6925321 20.75 162 C20.74823761 160.98075439 20.74647522 159.96150879 20.74465942 158.91137695 C20.65648116 136.08464947 19.26987173 111.92798369 2.5546875 94.46484375 C-33.62712973 63.61831143 -112.36553129 77.80177374 -143.75 77.5 C-143.75 191.02 -143.75 304.54 -143.75 421.5 C-129.23 421.5 -114.71 421.5 -99.75 421.5 C-103.21701371 425.66041646 -105.67702508 428.47754873 -109.75 431.6875 C-113.46095259 434.64826002 -117.11354046 437.65130398 -120.70727539 440.75170898 C-130.55755166 449.23208883 -137.41757746 454.94709545 -150.71875 454.76953125 C-160.23544406 453.92333036 -165.99331403 446.9615051 -171.83203125 440.02734375 C-173.31783065 438.20958196 -174.7953 436.38498862 -176.265625 434.5546875 C-179.03479718 431.14982485 -181.88238854 427.82186862 -184.75 424.5 C-189.25856384 419.27178622 -193.66964461 413.98044 -198.0078125 408.609375 C-199.72777519 406.45895522 -199.72777519 406.45895522 -201.75 404.5 C-201.46461583 400.79771883 -199.60160711 399.0536163 -197.0625 396.5 C-186.66217728 385.11183301 -182.85949654 370.62986702 -183.3984375 355.46875 C-184.76199583 340.07569154 -192.37567125 327.72896904 -203.828125 317.67578125 C-208.15936937 314.29093083 -212.74064361 311.73960426 -217.75 309.5 C-218.61625 309.108125 -219.4825 308.71625 -220.375 308.3125 C-231.60865785 304.46940653 -247.18525957 304.8885445 -258.1328125 309.21484375 C-261.76849092 311.00012465 -265.21128301 313.00367798 -268.59375 315.23046875 C-270.67938789 316.45842584 -272.38603986 317.05407116 -274.75 317.5 C-279.94422457 311.39314532 -285.1338233 305.2866974 -290.1875 299.0625 C-293.69670395 294.74542175 -297.30111984 290.52198708 -300.9375 286.3125 C-316.47716077 268.24199733 -316.47716077 268.24199733 -316.09375 255.4296875 C-314.76604644 244.11403212 -305.11343632 237.6815324 -296.83984375 231.01953125 C-293.42590783 228.23572763 -290.08456179 225.37784713 -286.75 222.5 C-281.76094074 218.19987717 -276.70777495 213.99513496 -271.59375 209.84375 C-268.27313514 207.10697951 -265.00953218 204.3089705 -261.75 201.5 C-257.62531796 197.94546839 -253.47792288 194.43207857 -249.25 191 C-243.84923828 186.61287098 -238.575323 182.08776588 -233.30078125 177.55078125 C-226.03968997 171.30572679 -218.74446571 165.1036885 -211.3125 159.0625 C-206.44870975 155.10491812 -201.69118769 151.03457554 -196.94165039 146.94165039 C-193.41701081 143.91054711 -189.85960118 140.93014684 -186.25 138 C-181.32382849 134.00067853 -176.50072407 129.89082883 -171.6953125 125.74804688 C-171.13972656 125.26916016 -170.58414063 124.79027344 -170.01171875 124.296875 C-169.52662842 123.87760742 -169.04153809 123.45833984 -168.54174805 123.02636719 C-166.75 121.5 -166.75 121.5 -163.59643555 119.60766602 C-161.40557666 117.76652199 -160.8067466 116.75942049 -160.18760681 113.9289856 C-159.95746769 110.60029898 -159.9195382 107.31707059 -159.9453125 103.98046875 C-159.93160614 102.76676102 -159.91789978 101.55305328 -159.90377808 100.30256653 C-159.86642282 96.43050253 -159.87019725 92.5597189 -159.875 88.6875 C-159.85687736 86.06052678 -159.83607606 83.43357057 -159.8125 80.80664062 C-159.7605967 74.37096807 -159.74244724 67.93586259 -159.75 61.5 C-158.95645615 61.51633987 -158.16291229 61.53267975 -157.34532166 61.54951477 C-149.7999776 61.69306516 -142.25779634 61.77224818 -134.71118832 61.78240681 C-130.83265259 61.789811 -126.95745646 61.82051785 -123.07983398 61.90795898 C-102.28557941 63.11768056 -102.28557941 63.11768056 -84.4765625 54.203125 C-82.92090693 52.54151399 -81.46758932 50.85248996 -80.05812073 49.06575012 C-78.05350779 46.66633631 -75.65441603 44.83987134 -73.1875 42.9375 C-69.02518204 39.56448085 -64.93636618 36.1180635 -60.875 32.625 C-59.99062256 31.86437256 -59.99062256 31.86437256 -59.08837891 31.08837891 C-58.20351807 30.32726807 -58.20351807 30.32726807 -57.30078125 29.55078125 C-15.75491494 -6.18161593 -15.75491494 -6.18161593 0 0 Z " transform="translate(328.75,23.5)"></path>
            <path fill="#98A7B8" d="M0 0 C19 0 19 0 27 5 C28.83984375 7.4296875 28.83984375 7.4296875 29.9375 9.875 C30.31777344 10.67679687 30.69804687 11.47859375 31.08984375 12.3046875 C33.58791358 19.70240504 33.19166726 27.52040904 33.23828125 35.23828125 C33.246353 36.51422653 33.25442474 37.79017181 33.26274109 39.1047821 C33.27653944 41.79865103 33.28756851 44.49239941 33.29516602 47.1862793 C33.3062216 50.61229208 33.3406412 54.03765391 33.38033772 57.46343708 C33.41298639 60.76331918 33.41729617 64.06326231 33.42578125 67.36328125 C33.44328934 68.58026199 33.46079742 69.79724274 33.47883606 71.05110168 C33.45875021 79.00063977 32.80198873 86.78827007 27.24971008 92.93891907 C18.9102186 100.65498316 12.2232581 99 0 99 C0 66.33 0 33.66 0 0 Z " transform="translate(253,285)"></path>
            <path fill="#98A7B8" d="M0 0 C18 0 18 0 24 3 C27.79175376 7.09919326 29.11585045 10.15124271 29.16113281 15.67993164 C29.17074036 16.62844498 29.1803479 17.57695831 29.19024658 18.55421448 C29.19449646 19.57917526 29.19874634 20.60413605 29.203125 21.66015625 C29.20882507 22.71980087 29.21452515 23.7794455 29.22039795 24.87120056 C29.22985133 27.11814373 29.23638327 29.36510079 29.24023438 31.61206055 C29.24989338 35.0248291 29.28089475 38.43698338 29.3125 41.84960938 C29.31903499 44.03645477 29.32428351 46.22330446 29.328125 48.41015625 C29.3404718 49.42094742 29.3528186 50.43173859 29.36553955 51.47315979 C29.34141299 59.27587461 28.33044835 66.43150096 24 73.0625 C17.63060644 79.23285001 8.7817496 76 0 76 C0 50.92 0 25.84 0 0 Z " transform="translate(253,154)"></path>
        </svg>

    </div>
    <gux-tooltip placement="right" id="gux-tooltip-uoz2uq1885" class="" role="tooltip" hydrated="" data-placement="right" style="left: 71px; top: 595.5px; visibility: visible;">Becker Tickets</gux-tooltip>
</a>`;
sidebar.insertBefore(newLiBtn, sidebar.querySelector('LI.spacer'));


// add CSS rule to hide the original app button
var styleSheet = document.createElement("style");
styleSheet.textContent = `*[title="Becker Ticketer Installer"] { display: none !important; }`;
document.head.appendChild(styleSheet);

})();